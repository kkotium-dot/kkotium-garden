'use client';

import { useEffect } from 'react';
import { Info, TrendingUp } from 'lucide-react';

interface ProductSeoFormProps {
  seoData: {
    title: string;
    description: string;
    keywords: string;
    naver_title: string;
    naver_description: string;
    og_image: string;
    seo_score: number;
    seo_valid: boolean;
  };
  onSeoChange: (updates: any) => void;
}

export default function ProductSeoForm({ seoData, onSeoChange }: ProductSeoFormProps) {
  // ì‹¤ì‹œê°„ ì ìˆ˜ ê³„ì‚°
  const calculateScore = () => {
    let score = 0;
    const titleLen = (seoData.title || '').trim().length;
    const descLen = (seoData.description || '').trim().length;
    const kwList = (seoData.keywords || '').split(',').map(k => k.trim()).filter(Boolean);
    const naverTitleLen = (seoData.naver_title || '').trim().length;
    const naverDescLen = (seoData.naver_description || '').trim().length;

    // SEO ì œëª© (10~60ì): 20ì 
    if (titleLen >= 10 && titleLen <= 60) score += 20;

    // SEO ì„¤ëª… (50~160ì): 25ì 
    if (descLen >= 50 && descLen <= 160) score += 25;

    // í‚¤ì›Œë“œ (3~10ê°œ): 15ì 
    if (kwList.length >= 3 && kwList.length <= 10) score += 15;

    // ë„¤ì´ë²„ ìƒí’ˆëª… (10~100ì): 20ì 
    if (naverTitleLen >= 10 && naverTitleLen <= 100) score += 20;

    // ë„¤ì´ë²„ ì„¤ëª… (50~500ì): 20ì 
    if (naverDescLen >= 50 && naverDescLen <= 500) score += 20;

    return score;
  };

  // ì…ë ¥í•  ë•Œë§ˆë‹¤ ì ìˆ˜ ì—…ë°ì´íŠ¸
  useEffect(() => {
    const score = calculateScore();
    const valid = score >= 80;

    // ì ìˆ˜ê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
    if (score !== seoData.seo_score || valid !== seoData.seo_valid) {
      onSeoChange({ seo_score: score, seo_valid: valid });
    }
  }, [seoData.title, seoData.description, seoData.keywords, seoData.naver_title, seoData.naver_description]);

  const handleChange = (field: string) => (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    onSeoChange({ [field]: e.target.value });
  };

  const currentScore = calculateScore();

  return (
    <div className="space-y-6">
      {/* ì ìˆ˜ í‘œì‹œ */}
      <div className={`p-6 rounded-2xl border-2 ${
        currentScore >= 80 
          ? 'bg-gradient-to-r from-green-50 to-emerald-50 border-green-200' 
          : 'bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200'
      }`}>
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-xl font-bold text-gray-900 flex items-center gap-2">
            <TrendingUp className="w-6 h-6" />
            SEO ì ìˆ˜
          </h3>
          <div className={`text-4xl font-black ${
            currentScore >= 80 ? 'text-green-600' : 'text-yellow-600'
          }`}>
            {currentScore}/100
          </div>
        </div>
        <div className="w-full bg-gray-200 rounded-full h-3">
          <div 
            className={`h-3 rounded-full transition-all duration-300 ${
              currentScore >= 80 ? 'bg-green-500' : 'bg-yellow-500'
            }`}
            style={{ width: `${currentScore}%` }}
          />
        </div>
        <p className="text-sm text-gray-600 mt-2">
          {currentScore >= 80 
            ? 'âœ… ê²€ìƒ‰ ìµœì í™” ì™„ë£Œ! ìƒí’ˆ ë“±ë¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.' 
            : `âš ï¸ ${80 - currentScore}ì  ë” í•„ìš”í•©ë‹ˆë‹¤.`}
        </p>
      </div>

      {/* ì¼ë°˜ SEO */}
      <div className="bg-white p-6 rounded-2xl border border-gray-200 space-y-4">
        <h4 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
          ğŸ” ì¼ë°˜ SEO (ê²€ìƒ‰ì—”ì§„ ìµœì í™”)
        </h4>

        <div>
          <label className="block text-sm font-semibold text-gray-800 mb-2 flex items-center gap-2">
            SEO ì œëª©
            <span className={`text-xs px-2 py-0.5 rounded ${
              (seoData.title || '').length >= 10 && (seoData.title || '').length <= 60
                ? 'bg-green-100 text-green-700'
                : 'bg-gray-100 text-gray-500'
            }`}>
              {(seoData.title || '').length}/60
            </span>
          </label>
          <input
            type="text"
            value={seoData.title}
            onChange={handleChange('title')}
            maxLength={60}
            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="ê²€ìƒ‰ì—”ì§„ì— í‘œì‹œë  ì œëª© (10~60ì)"
          />
          <p className="text-xs text-gray-500 mt-1">
            <Info className="w-3 h-3 inline mr-1" />
            Google, Naver ê²€ìƒ‰ ê²°ê³¼ì— í‘œì‹œë©ë‹ˆë‹¤
          </p>
        </div>

        <div>
          <label className="block text-sm font-semibold text-gray-800 mb-2 flex items-center gap-2">
            SEO ì„¤ëª…
            <span className={`text-xs px-2 py-0.5 rounded ${
              (seoData.description || '').length >= 50 && (seoData.description || '').length <= 160
                ? 'bg-green-100 text-green-700'
                : 'bg-gray-100 text-gray-500'
            }`}>
              {(seoData.description || '').length}/160
            </span>
          </label>
          <textarea
            value={seoData.description}
            onChange={handleChange('description')}
            maxLength={160}
            rows={3}
            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 resize-vertical"
            placeholder="ê²€ìƒ‰ ê²°ê³¼ì— í‘œì‹œë  ì„¤ëª… (50~160ì)"
          />
        </div>

        <div>
          <label className="block text-sm font-semibold text-gray-800 mb-2 flex items-center gap-2">
            í‚¤ì›Œë“œ
            <span className={`text-xs px-2 py-0.5 rounded ${
              (seoData.keywords || '').split(',').map(k => k.trim()).filter(Boolean).length >= 3
                ? 'bg-green-100 text-green-700'
                : 'bg-gray-100 text-gray-500'
            }`}>
              {(seoData.keywords || '').split(',').map(k => k.trim()).filter(Boolean).length}ê°œ
            </span>
          </label>
          <input
            type="text"
            value={seoData.keywords}
            onChange={handleChange('keywords')}
            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500"
            placeholder="ì¥ë¯¸ê½ƒë‹¤ë°œ, ìƒì¼ì„ ë¬¼, í”„ë¦¬ë¯¸ì—„ê½ƒ (ì‰¼í‘œë¡œ êµ¬ë¶„, 3~10ê°œ)"
          />
          <p className="text-xs text-gray-500 mt-1">
            <Info className="w-3 h-3 inline mr-1" />
            ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•´ì„œ ì…ë ¥í•˜ì„¸ìš”
          </p>
        </div>
      </div>

      {/* ë„¤ì´ë²„ ì „ìš© */}
      <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-2xl border-2 border-green-200 space-y-4">
        <h4 className="text-lg font-bold text-green-900 mb-4 flex items-center gap-2">
          ğŸ›’ ë„¤ì´ë²„ ì‡¼í•‘ ì „ìš© (ê²€ìƒ‰ ë…¸ì¶œ í•µì‹¬!)
        </h4>

        <div>
          <label className="block text-sm font-black text-green-900 mb-2 flex items-center gap-2 bg-green-100 p-2 rounded-lg">
            ë„¤ì´ë²„ ìƒí’ˆëª… *
            <span className={`text-xs px-2 py-0.5 rounded ${
              (seoData.naver_title || '').length >= 10 && (seoData.naver_title || '').length <= 100
                ? 'bg-green-200 text-green-800'
                : 'bg-white text-gray-500'
            }`}>
              {(seoData.naver_title || '').length}/100
            </span>
          </label>
          <input
            type="text"
            value={seoData.naver_title}
            onChange={handleChange('naver_title')}
            maxLength={100}
            className="w-full px-4 py-3 border-2 border-green-300 rounded-xl focus:ring-2 focus:ring-green-500 bg-white font-medium"
            placeholder="ë„¤ì´ë²„ ì‡¼í•‘ ê²€ìƒ‰ì— í‘œì‹œë  ìƒí’ˆëª… (10~100ì)"
          />
          <p className="text-xs text-green-700 mt-1 font-medium">
            ğŸ’¡ ë„¤ì´ë²„ ê²€ìƒ‰ ì‹œ ì´ ì´ë¦„ìœ¼ë¡œ ë…¸ì¶œë©ë‹ˆë‹¤ (ê²€ìƒ‰ ìˆœìœ„ì— í° ì˜í–¥!)
          </p>
        </div>

        <div>
          <label className="block text-sm font-black text-green-900 mb-2 flex items-center gap-2 bg-green-100 p-2 rounded-lg">
            ë„¤ì´ë²„ ìƒí’ˆ ìƒì„¸ì„¤ëª… *
            <span className={`text-xs px-2 py-0.5 rounded ${
              (seoData.naver_description || '').length >= 50 && (seoData.naver_description || '').length <= 500
                ? 'bg-green-200 text-green-800'
                : 'bg-white text-gray-500'
            }`}>
              {(seoData.naver_description || '').length}/500
            </span>
          </label>
          <textarea
            value={seoData.naver_description}
            onChange={handleChange('naver_description')}
            maxLength={500}
            rows={6}
            className="w-full px-4 py-3 border-2 border-green-300 rounded-xl focus:ring-2 focus:ring-green-500 bg-white resize-vertical"
            placeholder="ë„¤ì´ë²„ ìƒí’ˆ í˜ì´ì§€ì— í‘œì‹œë  ìƒì„¸ ì„¤ëª… (50~500ì)&#10;&#10;ì˜ˆì‹œ:&#10;- ì‹ ì„ í•œ ì¥ë¯¸ë¡œ ì œì‘í•œ í”„ë¦¬ë¯¸ì—„ ê½ƒë‹¤ë°œ&#10;- íŠ¹ë³„í•œ ë‚ ì„ ë”ìš± ì•„ë¦„ë‹µê²Œ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤&#10;- ë¬´ë£Œ ë¦¬ë³¸ í¬ì¥ ì„œë¹„ìŠ¤&#10;- ë‹¹ì¼ ë°°ì†¡ ê°€ëŠ¥"
          />
          <p className="text-xs text-green-700 mt-1 font-medium">
            ğŸ’¡ ë„¤ì´ë²„ ìƒí’ˆ í˜ì´ì§€ ìƒë‹¨ì— í‘œì‹œë˜ë©°, êµ¬ë§¤ ê²°ì •ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤
          </p>
        </div>
      </div>

      {/* OG ì´ë¯¸ì§€ */}
      <div className="p-4 bg-purple-50 rounded-xl border border-purple-200">
        <label className="block text-sm font-semibold text-purple-900 mb-2">
          OG ì´ë¯¸ì§€ (ì†Œì…œ ê³µìœ ìš©)
        </label>
        <input
          type="text"
          value={seoData.og_image}
          onChange={handleChange('og_image')}
          className="w-full px-4 py-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
          placeholder="https://example.com/og-image.jpg"
        />
        <p className="text-xs text-purple-700 mt-1">
          <Info className="w-3 h-3 inline mr-1" />
          ì¹´ì¹´ì˜¤í†¡, í˜ì´ìŠ¤ë¶ ê³µìœ  ì‹œ í‘œì‹œë  ì´ë¯¸ì§€
        </p>
      </div>
    </div>
  );
}
